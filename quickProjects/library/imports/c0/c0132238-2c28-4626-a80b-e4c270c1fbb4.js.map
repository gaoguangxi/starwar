{"version":3,"sources":["../../../../assets/resource/assets/resource/myWebSocket.js"],"names":["cc","Class","extends","Component","properties","URL","default","serializable","onLoad","MSG","require","game","addPersistRootNode","node","ws","WebSocket","onopen","_onWebSocketOpen","onmessage","_onWebSocketMessage","onerror","_onWebSocketError","onclose","_onWebSocketClose","curSocketComponent","msgHandlerMap","Map","registMessageHandle","LoginMsgClient","handlerLogin","fr","FileReader","callbackObj","onload","msg","JSON","parse","result","log","undefined","handleServerMsg","start","update","dt","stringify","sendMessage","sendMsg","send","event","data","readAsText","msgType","handlerMap","get","handlermap","handler","call","obj","Method","set","unRegistMessageHandler","delete"],"mappings":"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","file":"myWebSocket.js","sourceRoot":"../../../../assets/resource","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        URL: {\n             // ATTRIBUTES:\n             default: \"url\",        // The default value will be used only when the component attaching\n                                   // to a node for the first time\n             //type: cc.String, // optional, default is typeof default\n             serializable: true,   // optional, default is true\n         },\n        //  bar: {\n        //      get () {\n        //          return this._bar;\n        //      },\n        //      set (value) {\n        //          this._bar = value;\n        //      }\n        //  }, \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n   \n     onLoad () \n     {\n         var MSG = require(\"msg\");\n         cc.game.addPersistRootNode(this.node);\n         this.ws = new WebSocket(this.URL);\n         this.ws.onopen = this._onWebSocketOpen;\n         this.ws.onmessage = this._onWebSocketMessage;\n         this.ws.onerror = this._onWebSocketError;\n         this.ws.onclose = this._onWebSocketClose;\n         this.ws.curSocketComponent = this;\n         this.msgHandlerMap = new Map();\n         this.registMessageHandle(MSG.LoginMsgClient,this,this.handlerLogin);\n         this.fr = new FileReader();\n         this.fr.callbackObj = this;\n         this.fr.onload = function() {\n            var msg = JSON.parse(this.result);\n            cc.log(\"msg = \"+ this.result);\n            if(msg!=undefined)\n                this.callbackObj.handleServerMsg(msg);\n        };\n         \n     },\n\n    start () {\n\n    },\n\n     update (dt) \n     {\n\n     },\n     handlerLogin:function(msg)\n     {\n        cc.log(\"msg = \"+ JSON.stringify(msg));\n     },\n     sendMessage:function(msg)\n     {\n        var sendMsg = {msg};\n        cc.log(\"msg = \"+ JSON.stringify(sendMsg));\n        this.ws.send(JSON.stringify(sendMsg));\n     },\n     _onWebSocketOpen:function(event)\n     {\n        cc.log(\"webSocket is connected.....\");\n     },\n     _onWebSocketClose:function(event)\n     {\n        cc.log(\"webSocket be closed.....\");\n     },\n     _onWebSocketMessage:function(event)\n     {\n        cc.log(\"webSocket recive message = \"+event.data);\n        this.curSocketComponent.fr.readAsText(event.data);\n     },\n     handleServerMsg:function(msg)\n     {\n        if(msg.msgType == undefined)\n            return;\n        var handlerMap = this.curSocketComponent.msgHandlerMap.get(msg.msgType);\n        if(handlermap == undefined)\n            return;\n        for (var handler of handlerMap) { // 遍历Map\n         handler[1].call(handler[0],msg);\n        }\n     },\n     _onWebSocketError:function(event)\n     {\n        cc.log(\"webSocket error = \"+JSON.stringify(event));\n     },\n     registMessageHandle:function(msgType,obj,Method)\n     {\n         if(msgType == undefined||obj == undefined || Method== undefined)\n           return;\n        var handler = this.msgHandlerMap.get(msgType);\n        if(handler == undefined)\n        {\n            var handlermap = new Map();\n            handlermap.set(obj,Method);\n            this.msgHandlerMap.set(msgType,handlermap);\n        }\n        else\n        {\n            handler.set(obj,Method);\n        }\n     },\n     unRegistMessageHandler:function(msgType,obj)\n     {\n        if(msgType == undefined||obj == undefined )\n            return;\n        var handler = this.msgHandlerMap.get(msgType);\n        handler.delete(obj);\n     },\n});\n"]}